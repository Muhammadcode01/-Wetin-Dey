// ======== Pidgin Dictionary Data ========
// A comprehensive list of Pidgin English phrases and their English translations.
// Added more entries for richer content.
const pidginDictionary = [
    { pidgin: "how far", english: "how are you / hello" },
    { pidgin: "i dey", english: "i am fine / i am here" },
    { pidgin: "wetin dey happen", english: "what's going on? / what's up?" },
    { pidgin: "abeg", english: "please / i beg you" },
    { pidgin: "na wah", english: "this is serious/unbelievable / what a pity" },
    { pidgin: "chop", english: "eat / food" },
    { pidgin: "waka", english: "walk or move / journey" },
    { pidgin: "jollof", english: "rice cooked in tomato sauce" },
    { pidgin: "e don do", english: "that's enough / it is finished" },
    { pidgin: "oga", english: "boss or senior person / sir" },
    { pidgin: "sabi", english: "to know / understand / be skilled at" },
    { pidgin: "gidigba", english: "strong / robust / firm / very well" },
    { pidgin: "wahala", english: "trouble / problem / difficulty" },
    { pidgin: "ashewo", english: "prostitute" },
    { pidgin: "doro", english: "term of endearment, usually for a beautiful woman" },
    { pidgin: "fiam", english: "quickly / suddenly (sound effect)" },
    { pidgin: "kolo", english: "go crazy / lose your mind" },
    { pidgin: "lai-lai", english: "never / impossible" },
    { pidgin: "mumu", english: "fool / stupid person" },
    { pidgin: "shine your eye", english: "be careful / be alert" },
    { pidgin: "yeye", english: "useless / rubbish / fake" },
    { pidgin: "kpai", english: "to die / kill" },
    { pidgin: "biko", english: "please (Igbo origin)" },
    { pidgin: "oga at the top", english: "a respected or superior person (often used sarcastically)" },
    { pidgin: "sharp sharp", english: "quickly / immediately" },
    { pidgin: "shele", english: "happen / occurred" },
    { pidgin: "gbam", english: "exactly / precisely (sound of impact)" },
    { pidgin: "nká»", english: "really? / is that so? (used to express surprise or doubt)" },
    { pidgin: "dey go", english: "continue / keep going" },
    { pidgin: "pepper dem", english: "to impress / show off / make others envious" },
    { pidgin: "dey there", english: "stay there / calm down" },
    { pidgin: "na so", english: "that's how it is / exactly" },
    { pidgin: "commot", english: "get out / leave" },
    { pidgin: "how bodi", english: "how are you? (less formal)" },
    { pidgin: "long throat", english: "greed / excessive desire" },
    { pidgin: "abi", english: "right? / isn't it? (confirmation tag)" },
    { pidgin: "kpata kpata", english: "totally / completely" },
    { pidgin: "wetin concern me", english: "what's that got to do with me? / it's not my business" },
    { pidgin: "dey form", english: "to pretend / act fancy" },
    { pidgin: "yarn", english: "to talk / chat" },
    { pidgin: "fall hand", english: "to disappoint / let down" },
    { pidgin: "guy man", english: "a sharp, clever person (can be negative or positive)" },
    { pidgin: "jejely", english: "gently / carefully / calmly" },
    { pidgin: "omo", english: "child / son / daughter (often used as an exclamation of surprise)" },
    { pidgin: "gbagaun", english: "a big mistake / blunder (especially in speech)" },
    { pidgin: "kpekere", english: "plantain chips" },
    { pidgin: "magana", english: "talk / discussion (Hausa origin)" },
    { pidgin: "no vex", english: "don't be angry / please" },
    { pidgin: "pati", english: "party" },
    { pidgin: "shakara", english: "showing off / pretense" },
    { pidgin: "yepa", english: "exclamation of surprise or shock" },
    { pidgin: "go slow", english: "traffic jam" },
    { pidgin: "come wetin", english: "why? / for what reason?" },
    { pidgin: "e pain me", english: "it hurts me / I'm sad about it" },
    { pidgin: "dey craze", english: "to be crazy" },
    { pidgin: "dem no send you", english: "they don't care about you / they ignore you" },
    { pidgin: "face me i face you", english: "a type of residential apartment where tenants share facilities" },
    { pidgin: "i go come", english: "I will come / I'll be back" },
    { pidgin: "k Leg", english: "run away / escape" },
    { pidgin: "lazy man", english: "a lazy person" },
    { pidgin: "na my word be that", english: "that's my final word / that's what I said" },
    { pidgin: "wey", english: "where" },
    { pidgin: "your head no correct", english: "you are not thinking straight / you are crazy" },
    { pidgin: "craze don catch am", english: "he/she has gone mad" },
    { pidgin: "give me space", english: "give me some room / leave me alone" },
    { pidgin: "how your side", english: "how are things with you? / how's your end?" },
    { pidgin: "i no fit", english: "I can't" },
    { pidgin: "na true", english: "it's true / that's right" },
    { pidgin: "small small", english: "gently / little by little" },
    { pidgin: "wetin you dey do", english: "what are you doing?" },
    { pidgin: "yepa!", english: "an exclamation of surprise or shock" },
    { pidgin: "area boy", english: "street tout / local hoodlum" },
    { pidgin: "carry go", english: "take away / continue" },
    { pidgin: "do am well", english: "do it properly" },
    { pidgin: "e get as e be", english: "it's complicated / it's a bit tricky" },
    { pidgin: "gbana", english: "marijuana" },
    { pidgin: "i sabi speak english", english: "I know how to speak English" },
    { pidgin: "kola nut", english: "a stimulant nut, culturally significant" },
    { pidgin: "madam", english: "madam / respected woman" },
    { pidgin: "na me talk am", english: "I said it" },
    { pidgin: "sisi", english: "young lady / girl" },
    { pidgin: "wehrey", english: "crazy person (derogatory, but can be used playfully)" },
    { pidgin: "dey vex", english: "to be angry" },
    { pidgin: "fine fine", english: "very good / beautiful" },
    { pidgin: "go do am", english: "go and do it" },
    { pidgin: "how market", english: "how's business? / how are things going?" },
    { pidgin: "i no sure", english: "I'm not sure" },
    { pidgin: "jeje", english: "gently / quietly" },
    { pidgin: "kudi", english: "money (Hausa origin)" },
    { pidgin: "larry", english: "friendly term for a guy" },
    { pidgin: "omo gbege", english: "troublemaker" },
    { pidgin: "pikin", english: "child" },
    { pidgin: "susu", english: "savings contribution scheme" },
    { pidgin: "vibrate", english: "to make noise / create a scene" },
    { pidgin: "wash", english: "to bribe / to treat someone well" },
    { pidgin: "yan", english: "to talk / gist" },
    { pidgin: "zagali", english: "to wander aimlessly" },
    { pidgin: "zurum", english: "to dash / to run quickly" },
    { pidgin: "akara", english: "bean cake fritters" },
    { pidgin: "baff up", english: "to dress up smartly" },
    { pidgin: "danfo", english: "yellow commercial bus (Lagos)" },
    { pidgin: "efik", english: "a common Nigerian ethnic group/language" },
    { pidgin: "fada", english: "priest or elder" },
    { pidgin: "gbedu", english: "big drum / loud music" },
    { pidgin: "hot dog", english: "a fancy person / someone who shows off" },
    { pidgin: "iyanga", english: "showing off / pride" },
    { pidgin: "keke napep", english: "motorized tricycle" },
    { pidgin: "las las", english: "at last / finally" },
    { pidgin: "mama put", english: "local food vendor" },
    { pidgin: "no dulling", english: "no hesitation / be active" },
    { pidgin: "okada", english: "motorcycle taxi" },
    { pidgin: "palava", english: "trouble / conflict" },
    { pidgin: "rubbish", english: "nonsense" },
    { pidgin: "shine my eye", english: "to open my eyes to reality / to be enlightened" },
    { pidgin: "tush", english: "posh / sophisticated" },
    { pidgin: "up NEPA!", english: "exclamation when electricity supply returns" },
    { pidgin: "village people", english: "a superstitious term for mystical saboteurs of one's progress" },
    { pidgin: "weyrey", english: "crazy (more intense than wehrey, sometimes affectionate)" },
    { pidgin: "yamayama", english: "messy / unkempt / disorganized" },
    { pidgin: "za oza room", english: "a private place, usually referring to a bedroom" },
    { pidgin: "zed", english: "to escape / run away fast" },
    { pidgin: "chop money", english: "to embezzle money / to spend money lavishly" },
    { pidgin: "dey craze", english: "to be behaving foolishly or wildly" },
    { pidgin: "e go better", english: "it will get better / things will improve" },
    { pidgin: "gist", english: "gossip / informal conversation" },
    { pidgin: "igbo", english: "a common Nigerian ethnic group/language; also refers to marijuana" },
    { pidgin: "kele", english: "greeting / to greet" },
    { pidgin: "lagos", english: "the largest city in Nigeria" },
    { pidgin: "na me go win", english: "I will win" },
    { pidgin: "oyinbo", english: "white person / foreigner" },
    { pidgin: "pata pata", english: "completely / entirely" },
    { pidgin: "suffer head", english: "one who endure hardship / unfortunate person" },
    { pidgin: "tatafo", english: "gossipmonger" },
    { pidgin: "wahala be like bicycle", english: "trouble is easy to acquire (like a bicycle)" },
    { pidgin: "yaga", english: "exclamation of excitement or approval" },
    { pidgin: "zeh", english: "slang for coolness or hype" },
    { pidgin: "bobo", english: "young man / guy" },
    { pidgin: "dada", english: "dreadlocks / rasta" },
    { pidgin: "e don cast", english: "it has been exposed / the secret is out" },
    { pidgin: "for where", english: "no way / absolutely not" },
    { pidgin: "gbese", english: "debt / trouble (often associated with dance moves)" },
    { pidgin: "hustle", english: "to work hard, often informally, to make money" },
    { pidgin: "igara", english: "a show of strength or aggression" },
    { pidgin: "kpatakpata", english: "totally / completely (emphasis)" },
    { pidgin: "legit", english: "legitimate / authentic" },
    { pidgin: "mafo", english: "don't be scared (Yoruba origin)" },
    { pidgin: "no dull me", english: "don't bore me / don't waste my time" },
    { pidgin: "omo baba olowo", english: "child of a rich father" },
    { pidgin: "pishure", english: "picture" },
    { pidgin: "sapa", english: "state of extreme poverty or broke-ness" },
    { pidgin: "small small", english: "gently / little by little" },
    { pidgin: "thunder fire you", english: "a strong curse (may be used playfully)" },
    { pidgin: "wayo", english: "trickery / deceit" },
    { pidgin: "yahoo boy", english: "internet fraudster" },
    { pidgin: "zobo", english: "hibiscus drink" },
    { pidgin: "aje butter", english: "someone who is privileged, often from a wealthy background" },
    { pidgin: "agbero", english: "a tout, often collecting money at bus stops" },
    { pidgin: "brouhaha", english: "a noisy and overexcited reaction or situation" },
    { pidgin: "crase", english: "madness / craziness" },
    { pidgin: "dey craze dey go", english: "keep going crazy (used to dismiss something absurd)" },
    { pidgin: "e remain small", english: "it remains a little / almost finished" },
    { pidgin: "freestyle", english: "to improvise / to do something without much planning" },
    { pidgin: "gist me", english: "tell me the latest news/gossip" },
    { pidgin: "guy", english: "friend / buddy (can also mean a con artist)" },
    { pidgin: "hard labour", english: "difficult work" },
    { pidgin: "i get am", english: "I have it / I understand" },
    { pidgin: "kain kain", english: "a type of local gin (alcoholic drink)" },
    { pidgin: "low key", english: "discreetly / secretly" },
    { pidgin: "make we yarn", english: "let's talk / let's chat" },
    { pidgin: "na only you waka come", english: "you came alone? / are you the only one here?" },
    { pidgin: "owo", english: "money (Yoruba origin)" },
    { pidgin: "padi", english: "friend / pal" },
    { pidgin: "run mad", english: "to go crazy" },
    { pidgin: "shalaye", english: "to explain in detail (Yoruba origin)" },
    { pidgin: "tins", english: "things" },
    { pidgin: "unlooking", english: "ignoring / pretending not to see" },
    { pidgin: "vex", english: "to be angry / annoyed" },
    { pidgin: "woro", english: "a small game or trivial matter" },
    { pidgin: "yahoo yahoo", english: "internet fraud" },
    { pidgin: "zion", english: "a place of peace and rest (often used spiritually)" },
    { pidgin: "chop up", english: "to eat a lot / to gain weight" },
    { pidgin: "dey fine", english: "to be good-looking / to be well" },
    { pidgin: "e shock me", english: "it shocked me / I'm surprised" },
    { pidgin: "follow come", english: "accompanying / naturally occurring" },
    { pidgin: "gbagam", english: "perfectly / accurately (sound effect)" },
    { pidgin: "high five", english: "to give a high-five / a friendly gesture" },
    { pidgin: "i no send you", english: "I don't care about you / I'm ignoring you" },
    { pidgin: "juju", english: "traditional African magic or charm" },
    { pidgin: "kukere", english: "a type of dance step" },
    { pidgin: "las las na everybody go chop breakfast", english: "everyone will eventually face challenges/disappointments" },
    { pidgin: "mama", english: "mother / respected elder woman" },
    { pidgin: "na so e be", english: "that's how it is / that's the truth" },
    { pidgin: "odu", english: "a big person / an important person" },
    { pidgin: "paraga", english: "local alcoholic concoction" },
    { pidgin: "sisi eko", english: "a sophisticated Lagos lady" },
    { pidgin: "soft work", english: "easy job / comfortable situation" },
    { pidgin: "too much", english: "excessive / very good (depending on context)" },
    { pidgin: "vawulence", english: "violence (often used playfully to describe intense drama)" },
    { pidgin: "weri", english: "crazy (alternative spelling of wehrey/weyrey)" },
    { pidgin: "yaro", english: "young boy (Hausa origin)" },
    { pidgin: "zoom", english: "to move quickly" }
];

// ======== DOM Elements ========
const searchInput = document.getElementById('search');
const resultsDiv = document.getElementById('results');
const clearSearchButton = document.getElementById('clearSearch');
const currentYearSpan = document.getElementById('currentYear');

const navLinks = document.querySelectorAll('.nav-link');
const searchModeLink = document.getElementById('searchModeLink');
const browseModeLink = document.getElementById('browseModeLink');
const favoritesModeLink = document.getElementById('favoritesModeLink');

const wordOfTheDaySection = document.getElementById('wordOfTheDaySection');
const wotdPidgin = document.getElementById('wotd-pidgin');
const wotdEnglish = document.getElementById('wotd-english');
const wotdPlayButton = wordOfTheDaySection.querySelector('.play-button');
const wotdFavoriteButton = wordOfTheDaySection.querySelector('.favorite-button');

const instructionText = document.getElementById('instructionText');
const mainSearchBox = document.querySelector('.search-box');

// ======== Global State / Constants ========
let currentView = 'search-mode'; // Default view
const FAVORITES_KEY = 'pidginTranslatorFavorites';
const WOTD_LAST_DATE_KEY = 'pidginTranslatorWOTDDate';
const WOTD_LAST_WORD_KEY = 'pidginTranslatorWOTDWord';

// Get available voices for speech synthesis
let voices = [];
const synth = window.speechSynthesis;
if (synth) {
    synth.onvoiceschanged = () => {
        voices = synth.getVoices();
    };
}

// ======== Utility Function: Debounce ========
const debounce = (func, delay) => {
    let timeoutId;
    return (...args) => {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
};

// ======== Speech Synthesis (Pronunciation) ========
function speakText(text, lang) {
    if (!synth) {
        console.warn("Web Speech API not supported in this browser.");
        return;
    }

    // Stop any ongoing speech
    if (synth.speaking) {
        synth.cancel();
    }

    const utterance = new SpeechSynthesisUtterance(text);
    // Attempt to find an English voice (Pidgin doesn't have a dedicated voice)
    const enVoice = voices.find(voice => voice.lang.startsWith('en-') || voice.lang === 'en-US');
    if (enVoice) {
        utterance.voice = enVoice;
    } else {
        // Fallback to default voice if no English voice is found
        console.warn("No English voice found, using default for pronunciation.");
    }
    utterance.pitch = 1;
    utterance.rate = 1;

    synth.speak(utterance);
}

// ======== Favorites Management ========
function getFavorites() {
    try {
        const favorites = localStorage.getItem(FAVORITES_KEY);
        return favorites ? JSON.parse(favorites) : [];
    } catch (e) {
        console.error("Error reading favorites from localStorage:", e);
        return [];
    }
}

function saveFavorites(favorites) {
    try {
        localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
    } catch (e) {
        console.error("Error writing favorites to localStorage:", e);
    }
}

function isFavorite(item) {
    const favorites = getFavorites();
    // Use a unique identifier (pidgin word + english translation) for comparison
    return favorites.some(fav => fav.pidgin === item.pidgin && fav.english === item.english);
}

function toggleFavorite(item, button) {
    let favorites = getFavorites();
    const index = favorites.findIndex(fav => fav.pidgin === item.pidgin && fav.english === item.english);

    if (index > -1) {
        // Already a favorite, remove it
        favorites.splice(index, 1);
        button.classList.remove('active');
    } else {
        // Not a favorite, add it
        favorites.push(item);
        button.classList.add('active');
    }
    saveFavorites(favorites);

    // Re-render the current view to update favorite statuses, especially if in favorites view
    updateView(true); // Pass true to force re-render without changing active nav link
}

// ======== Render Results Function ========
function renderResults(data) {
    resultsDiv.innerHTML = ''; // Always clear previous results first

    if (data.length === 0) {
        let message = 'No match found. Try another word or phrase!';
        if (currentView === 'favorites-mode') {
            message = 'You have no favorite words yet. Add some from the dictionary or search!';
        } else if (currentView === 'search-mode' && searchInput.value.trim() === '') {
            message = 'Start typing to find Pidgin or English words!';
        } else if (currentView === 'browse-mode') {
             message = 'No entries found for Browse. This should not happen, please check the dictionary data!';
        }
        resultsDiv.innerHTML = `<p class="no-results">${message}</p>`;
        return;
    }

    // Sort data alphabetically by pidgin word for dictionary-like display, unless it's favorites
    if (currentView !== 'favorites-mode') {
        data.sort((a, b) => a.pidgin.localeCompare(b.pidgin));
    }

    const fragment = document.createDocumentFragment();
    data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';

        const isFav = isFavorite(item);
        const favoriteClass = isFav ? 'active' : '';

        card.innerHTML = `
            <div class="pidgin">${item.pidgin}</div>
            <div class="english">${item.english}</div>
            <div class="card-actions">
                <button class="action-button play-button" aria-label="Play pronunciation" data-word-to-speak="${item.pidgin}" data-lang="pidgin-en">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 22.62"></path></svg>
                </button>
                <button class="action-button favorite-button ${favoriteClass}" aria-label="Add to favorites">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                </button>
            </div>
        `;
        fragment.appendChild(card);
    });
    resultsDiv.appendChild(fragment);

    // Attach event listeners to newly created buttons
    resultsDiv.querySelectorAll('.play-button').forEach(button => {
        button.addEventListener('click', (e) => {
            const word = e.currentTarget.dataset.wordToSpeak;
            speakText(word); // Pass only word, lang is handled internally
        });
    });

    resultsDiv.querySelectorAll('.favorite-button').forEach(button => {
        button.addEventListener('click', (e) => {
            const cardElement = e.currentTarget.closest('.card');
            const pidgin = cardElement.querySelector('.pidgin').textContent;
            const english = cardElement.querySelector('.english').textContent;
            toggleFavorite({ pidgin, english }, e.currentTarget);
        });
    });
}

// ======== View Management ========
function setActiveNavLink(activeLinkElement) {
    navLinks.forEach(link => link.classList.remove('active'));
    activeLinkElement.classList.add('active');
    currentView = activeLinkElement.dataset.view;
    updateView();
}

function updateView(forceRender = false) {
    // Only clear search input and hide elements if not a forced re-render (e.g., from favorite toggle)
    if (!forceRender) {
        searchInput.value = '';
        clearSearchButton.classList.remove('active');
    }

    // Hide all main content areas based on current view
    mainSearchBox.classList.add('hidden');
    resultsDiv.classList.add('hidden');

    if (currentView === 'search-mode') {
        wordOfTheDaySection.classList.remove('hidden'); // WOTD is always visible in search mode
        mainSearchBox.classList.remove('hidden');
        resultsDiv.classList.remove('hidden');
        instructionText.textContent = 'Enter a word or phrase in Pidgin or English to search.';
        // If input is empty, display initial message, otherwise show current search results
        if (searchInput.value.trim() === '') {
            displayInitialMessage();
        } else {
             const term = searchInput.value.toLowerCase().trim();
             const filtered = pidginDictionary.filter(entry =>
                entry.pidgin.toLowerCase().includes(term) ||
                entry.english.toLowerCase().includes(term)
            );
            renderResults(filtered);
        }
        searchInput.focus();
    } else if (currentView === 'browse-mode') {
        wordOfTheDaySection.classList.add('hidden'); // Hide WOTD in browse mode
        resultsDiv.classList.remove('hidden');
        instructionText.textContent = 'Browse through all available Pidgin words.';
        renderResults(pidginDictionary); // Show all words for Browse
    } else if (currentView === 'favorites-mode') {
        wordOfTheDaySection.classList.add('hidden'); // Hide WOTD in favorites mode
        resultsDiv.classList.remove('hidden');
        instructionText.textContent = 'Your saved Pidgin words and phrases.';
        renderResults(getFavorites()); // Show only favorites
    }
}

function displayInitialMessage() {
    resultsDiv.innerHTML = '<p class="no-results">Start typing to find Pidgin or English words!</p>';
}

// ======== Word of the Day Logic ========
function getWordOfTheDay() {
    const today = new Date().toDateString(); // e.g., "Fri Jul 05 2025"
    let lastWOTDDate = localStorage.getItem(WOTD_LAST_DATE_KEY);
    let lastWOTDWord = JSON.parse(localStorage.getItem(WOTD_LAST_WORD_KEY));

    if (lastWOTDDate === today && lastWOTDWord) {
        return lastWOTDWord; // Return cached WOTD if already set for today
    } else {
        // Pick a new random word
        const randomIndex = Math.floor(Math.random() * pidginDictionary.length);
        const newWOTD = pidginDictionary[randomIndex];

        // Store for today
        localStorage.setItem(WOTD_LAST_DATE_KEY, today);
        localStorage.setItem(WOTD_LAST_WORD_KEY, JSON.stringify(newWOTD));
        return newWOTD;
    }
}

function displayWordOfTheDay() {
    const wotd = getWordOfTheDay();
    if (wotd) {
        wotdPidgin.textContent = wotd.pidgin;
        wotdEnglish.textContent = wotd.english;

        // Update data attribute for play button in WOTD card
        wotdPlayButton.dataset.wordToSpeak = wotd.pidgin;

        // Update favorite button status for WOTD
        if (isFavorite(wotd)) {
            wotdFavoriteButton.classList.add('active');
        } else {
            wotdFavoriteButton.classList.remove('active');
        }
        wordOfTheDaySection.classList.remove('hidden'); // Ensure WOTD section is visible
    }
}

// ======== Event Listeners ========

// Navigation click handlers
navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault(); // Prevent default link behavior
        setActiveNavLink(e.target);
    });
});

// Handle input changes with debouncing for performance
searchInput.addEventListener('input', debounce(() => {
    const term = searchInput.value.toLowerCase().trim();

    if (term === '') {
        displayInitialMessage();
        clearSearchButton.classList.remove('active');
    } else {
        const filtered = pidginDictionary.filter(entry =>
            entry.pidgin.toLowerCase().includes(term) ||
            entry.english.toLowerCase().includes(term)
        );
        renderResults(filtered);
        clearSearchButton.classList.add('active');
    }
}, 300));

// Clear search input and re-render initial message
clearSearchButton.addEventListener('click', () => {
    searchInput.value = '';
    clearSearchButton.classList.remove('active');
    displayInitialMessage();
    searchInput.focus();
});

// WOTD Play and Favorite Buttons
wotdPlayButton.addEventListener('click', () => {
    // The word is already set on the button's data attribute by displayWordOfTheDay
    speakText(wotdPlayButton.dataset.wordToSpeak);
});

wotdFavoriteButton.addEventListener('click', (e) => {
    const pidgin = wotdPidgin.textContent;
    const english = wotdEnglish.textContent;
    toggleFavorite({ pidgin, english }, e.currentTarget);
});


// ======== Initial Load & Footer Year ========
document.addEventListener('DOMContentLoaded', () => {
    currentYearSpan.textContent = new Date().getFullYear();
    displayWordOfTheDay(); // Display Word of the Day on load
    setActiveNavLink(searchModeLink); // Set initial view to Search Mode
});